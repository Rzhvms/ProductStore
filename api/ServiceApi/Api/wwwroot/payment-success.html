<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оплата успешна</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display:flex; justify-content:center; align-items:center;
            min-height:100vh; padding:20px; color:#1d1d1f;
        }
        .success-card {
            width:100%; max-width:380px; background:rgba(255,255,255,0.95);
            backdrop-filter: blur(20px); border-radius:24px;
            box-shadow:0 10px 40px rgba(0,0,0,0.08),0 0 0 1px rgba(255,255,255,0.3) inset;
            overflow:hidden; position:relative; text-align:center;
        }
        .success-card::before {
            content:''; position:absolute; top:0; left:0; right:0; height:60px;
            background:linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0));
            z-index:1;
        }
        .header { padding:60px 32px 40px; position:relative; z-index:2; }
        .success-icon {
            width:80px; height:80px; background:linear-gradient(135deg, #34C759 0%, #30D158 100%);
            border-radius:50%; display:flex; align-items:center; justify-content:center;
            margin:0 auto 28px; box-shadow:0 12px 30px rgba(52,199,89,0.25);
            animation: successPop 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
        }
        .success-icon i { color:white; font-size:36px; font-weight:600; }
        .title {
            font-size:32px; font-weight:700; letter-spacing:-0.5px; margin-bottom:12px;
            background:linear-gradient(135deg, #1d1d1f 0%, #34C759 100%);
            -webkit-background-clip:text; -webkit-text-fill-color:transparent;
        }
        .subtitle { color:#86868b; font-size:17px; font-weight:500; line-height:1.4; }
        .content { padding:0 32px 40px; }
        .details-card {
            background:#f8f9fa; border-radius:20px; padding:24px; margin-bottom:32px;
            position:relative; overflow:hidden;
        }
        .details-card::before {
            content:''; position:absolute; top:0; left:0; right:0; height:2px;
            background:linear-gradient(to right, transparent, #34C759, transparent);
        }
        .detail-row {
            display:flex; justify-content:space-between; padding:14px 0; border-bottom:1px solid #f2f2f7;
        }
        .detail-row:last-child { border-bottom:none; }
        .detail-label { color:#86868b; font-size:15px; font-weight:500; text-align:left; }
        .detail-value { color:#1d1d1f; font-size:15px; font-weight:600; text-align:right; }
        .amount-display {
            background:linear-gradient(135deg, #34C75915 0%, #30D15810 100%);
            border-radius:18px; padding:20px; margin-bottom:24px; border:1px solid rgba(52,199,89,0.1);
        }
        .amount-label { color:#34C759; font-size:13px; font-weight:600; text-transform:uppercase; margin-bottom:6px; }
        .amount-value { font-size:36px; font-weight:800; letter-spacing:-1px; color:#1d1d1f; line-height:1; }
        .amount-currency { font-size:22px; font-weight:600; color:#86868b; margin-left:4px; }
        .actions { display:flex; flex-direction:column; gap:12px; }
        .button {
            padding:18px; border-radius:14px; font-size:17px; font-weight:600; border:none;
            cursor:pointer; transition:all 0.3s cubic-bezier(0.4,0,0.2,1); position:relative; overflow:hidden;
        }
        .button::after {
            content:''; position:absolute; top:50%; left:50%; width:5px; height:5px;
            background:rgba(255,255,255,0.5); opacity:0; border-radius:100%;
            transform:scale(1,1) translate(-50%); transform-origin:50% 50%;
        }
        .button:active::after { animation:ripple 0.6s ease-out; }
        @keyframes ripple { 0%{transform:scale(0,0);opacity:0.5;} 100%{transform:scale(40,40);opacity:0;} }
        .primary-button {
            background:linear-gradient(135deg, #FF6B35 0%, #FF9F1C 100%);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.25);
            color:#ffffff;
        }
        .primary-button:hover { ransform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.35); }
        .secondary-button {
            background:transparent; color:#86868b; border:2px solid #e5e5ea;
        }
        .secondary-button:hover { background:#f8f9fa; border-color:#d2d2d7; }
        .footer { padding:24px 32px; text-align:center; color:#86868b; font-size:12px; border-top:1px solid #f2f2f7; background:#f8f9fa; }
        .confirmation-badge { display:inline-flex; align-items:center; gap:6px; font-weight:600; letter-spacing:0.3px; color:#34C759; }
        @keyframes successPop {0%{transform:scale(0);opacity:0;}70%{transform:scale(1.1);opacity:1;}100%{transform:scale(1);}}
        .confetti { position:absolute; width:10px; height:10px; background:#34C759; border-radius:50%; opacity:0; }
        @media (max-width:400px) {
            .success-card { border-radius:20px; }
            .header { padding:40px 24px 32px; }
            .content { padding:0 24px 32px; }
            .amount-value { font-size:32px; }
            .button { padding:16px; }
        }
    </style>
</head>
<body>

<div class="success-card">
    <div class="header">
        <div class="success-icon"><i>􀣺</i></div>
        <h1 class="title">Оплата прошла успешно</h1>
        <div class="subtitle">Заказ подтвержден и передан в обработку</div>
    </div>

    <div class="content">
        <div class="details-card">
            <div class="amount-display">
                <div class="amount-label">Оплаченная сумма</div>
                <div>
                    <span class="amount-value" id="amount">0</span>
                    <span class="amount-currency">₽</span>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Номер заказа</div>
                <div class="detail-value" id="orderId">—</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Платеж</div>
                <div class="detail-value" id="paymentId">—</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Дата оплаты</div>
                <div class="detail-value" id="paymentDate">—</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">Статус</div>
                <div class="detail-value" style="color:#34C759;">Успешно</div>
            </div>
        </div>

        <div class="actions">
            <button class="button primary-button" onclick="goToOrders()">Перейти к заказам</button>
            <button class="button secondary-button" onclick="goHome()">Вернуться на главную</button>
        </div>
    </div>

    <div class="footer">
        <div class="confirmation-badge">􀣺 Чек отправлен на вашу почту</div>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const paymentId = urlParams.get('paymentId');

    function formatDateTime(date) {
        const d = new Date(date);
        const months = ['янв','фев','мар','апр','мая','июн','июл','авг','сен','окт','ноя','дек'];
        const day = d.getDate();
        const month = months[d.getMonth()];
        const hours = d.getHours().toString().padStart(2,'0');
        const minutes = d.getMinutes().toString().padStart(2,'0');
        return `${day} ${month}, ${hours}:${minutes}`;
    }

    async function loadPaymentData() {
        if (!paymentId) return null;
        try {
            const res = await fetch(`/api/mock-payments/${paymentId}`);
            if (!res.ok) throw new Error(res.status);
            return await res.json();
        } catch(e) { console.error('Ошибка загрузки:', e); return null; }
    }

    function goToOrders() {
        fadeOutAndRedirect('http://localhost:80/orders');
    }
    function goHome() {
        fadeOutAndRedirect('http://localhost:80');
    }
    function fadeOutAndRedirect(url){
        const card = document.querySelector('.success-card');
        card.style.opacity='0'; card.style.transform='translateY(20px)';
        setTimeout(()=>window.location.href=url,300);
    }

    function createConfetti() {
        const colors = ['#34C759','#30D158','#32D74B','#FFD60A','#FF9F0A'];
        for(let i=0;i<50;i++){
            setTimeout(()=>{
                const confetti=document.createElement('div');
                confetti.className='confetti';
                confetti.style.background=colors[Math.floor(Math.random()*colors.length)];
                confetti.style.left=Math.random()*100+'%';
                confetti.style.top='-20px';
                confetti.style.transform=`rotate(${Math.random()*360}deg)`;
                document.querySelector('.success-card').appendChild(confetti);
                setTimeout(()=>{
                    confetti.style.transition='all 1s cubic-bezier(0.4,0,0.2,1)';
                    confetti.style.opacity='0.8';
                    confetti.style.top=Math.random()*100+'%';
                    confetti.style.transform+=` translateX(${Math.random()*100-50}px)`;
                },10);
                setTimeout(()=>{ confetti.style.opacity='0'; setTimeout(()=>confetti.remove(),1000); },2000);
            },i*50);
        }
    }

    document.addEventListener('DOMContentLoaded', async()=>{
        const card = document.querySelector('.success-card');
        card.style.opacity='1'; card.style.transform='translateY(0)';

        const data = await loadPaymentData();
        if(data){
            document.getElementById('amount').textContent = (data.amount||0).toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2});
            if(data.orderId) document.getElementById('orderId').textContent = `#${data.orderId.substring(0,8).toUpperCase()}`;
            if(data.id) document.getElementById('paymentId').textContent = `#${data.id.substring(0,8).toUpperCase()}`;
            const paidDate = data.paidAt||data.updatedAt||new Date();
            document.getElementById('paymentDate').textContent = formatDateTime(paidDate);
        }

        createConfetti();
    });
</script>
</body>
</html>
